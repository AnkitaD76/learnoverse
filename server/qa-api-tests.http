### Community Q&A API Tests
### Base URL: http://localhost:3000/api/v1/qa

# Set your auth token here (get from login response)
@accessToken = YOUR_ACCESS_TOKEN_HERE
@baseUrl = http://localhost:3000/api/v1

###############################################
# AUTHENTICATION (for getting token)
###############################################

### Login
POST {{baseUrl}}/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "password123"
}

###############################################
# QUESTIONS
###############################################

### Get all questions (public)
GET {{baseUrl}}/qa/questions

### Get questions with filters
GET {{baseUrl}}/qa/questions?sort=votes&page=1&limit=10

### Search questions
GET {{baseUrl}}/qa/questions?search=react&sort=newest

### Filter by tag
GET {{baseUrl}}/qa/questions?tag=javascript

### Get unanswered questions
GET {{baseUrl}}/qa/questions?sort=unanswered

### Get single question
GET {{baseUrl}}/qa/questions/QUESTION_ID_HERE

### Create question (authenticated)
POST {{baseUrl}}/qa/questions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "How do I implement JWT authentication in Express?",
  "body": "I'm building an Express.js API and need to add JWT authentication. What's the best approach?\n\n```javascript\nconst express = require('express');\nconst app = express();\n```\n\nI've tried using passport.js but ran into issues with token validation.",
  "tags": ["javascript", "express", "jwt", "authentication"]
}

### Update question (authenticated, owner only)
PATCH {{baseUrl}}/qa/questions/QUESTION_ID_HERE
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "How do I implement JWT authentication in Express.js?",
  "body": "Updated body with more details...",
  "tags": ["javascript", "express", "jwt"]
}

### Delete question (authenticated, owner/admin only)
DELETE {{baseUrl}}/qa/questions/QUESTION_ID_HERE
Authorization: Bearer {{accessToken}}

###############################################
# ANSWERS
###############################################

### Get answers for a question
GET {{baseUrl}}/qa/questions/QUESTION_ID_HERE/answers

### Get answers sorted by oldest
GET {{baseUrl}}/qa/questions/QUESTION_ID_HERE/answers?sort=oldest

### Create answer (authenticated)
POST {{baseUrl}}/qa/questions/QUESTION_ID_HERE/answers
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "body": "You should use the `jsonwebtoken` package. Here's how:\n\n```javascript\nconst jwt = require('jsonwebtoken');\n\nconst token = jwt.sign({ userId: user.id }, process.env.JWT_SECRET, {\n  expiresIn: '1h'\n});\n```\n\nMake sure to keep your JWT_SECRET safe!"
}

### Update answer (authenticated, owner only)
PATCH {{baseUrl}}/qa/answers/ANSWER_ID_HERE
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "body": "Updated answer with additional information..."
}

### Delete answer (authenticated, owner/admin only)
DELETE {{baseUrl}}/qa/answers/ANSWER_ID_HERE
Authorization: Bearer {{accessToken}}

### Accept answer (authenticated, question owner only)
POST {{baseUrl}}/qa/answers/ANSWER_ID_HERE/accept
Authorization: Bearer {{accessToken}}

### Unaccept answer (authenticated, question owner only)
DELETE {{baseUrl}}/qa/answers/ANSWER_ID_HERE/accept
Authorization: Bearer {{accessToken}}

###############################################
# VOTING
###############################################

### Upvote a question
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "targetType": "Question",
  "targetId": "QUESTION_ID_HERE",
  "value": 1
}

### Downvote a question
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "targetType": "Question",
  "targetId": "QUESTION_ID_HERE",
  "value": -1
}

### Upvote an answer
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "targetType": "Answer",
  "targetId": "ANSWER_ID_HERE",
  "value": 1
}

### Remove vote (toggle off by clicking same vote)
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "targetType": "Question",
  "targetId": "QUESTION_ID_HERE",
  "value": 1
}

###############################################
# TAGS
###############################################

### Get all tags
GET {{baseUrl}}/qa/tags

### Get popular tags
GET {{baseUrl}}/qa/tags?sort=popular&limit=20

### Search tags
GET {{baseUrl}}/qa/tags?search=java

### Get single tag
GET {{baseUrl}}/qa/tags/javascript

###############################################
# USER STATS
###############################################

### Get user Q&A stats (public)
GET {{baseUrl}}/qa/users/USER_ID_HERE/stats

### Get my questions (authenticated)
GET {{baseUrl}}/qa/users/me/questions
Authorization: Bearer {{accessToken}}

### Get my questions with pagination
GET {{baseUrl}}/qa/users/me/questions?page=1&limit=5
Authorization: Bearer {{accessToken}}

### Get my answers (authenticated)
GET {{baseUrl}}/qa/users/me/answers
Authorization: Bearer {{accessToken}}

### Get my answers with pagination
GET {{baseUrl}}/qa/users/me/answers?page=1&limit=5
Authorization: Bearer {{accessToken}}

###############################################
# WORKFLOW EXAMPLES
###############################################

### Complete Q&A Flow:

# 1. Create a question
# 2. Another user creates an answer
# 3. Users upvote the answer
# 4. Question author accepts the answer
# 5. Check reputation updates

### Example: Create Question → Answer → Vote → Accept

# Step 1: Create question (User A)
POST {{baseUrl}}/qa/questions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "What's the difference between let and const in JavaScript?",
  "body": "I'm confused about when to use `let` vs `const` in modern JavaScript. Can someone explain?",
  "tags": ["javascript", "es6", "variables"]
}

# Step 2: Create answer (User B)
POST {{baseUrl}}/qa/questions/QUESTION_ID_FROM_STEP_1/answers
Content-Type: application/json
Authorization: Bearer USER_B_TOKEN

{
  "body": "`const` creates a constant reference that cannot be reassigned, while `let` allows reassignment.\n\n**Use const when:**\n- Value won't be reassigned\n- Working with objects/arrays (the reference is constant, not the contents)\n\n**Use let when:**\n- Value will be reassigned\n- Loop counters"
}

# Step 3: Upvote answer (User C)
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer USER_C_TOKEN

{
  "targetType": "Answer",
  "targetId": "ANSWER_ID_FROM_STEP_2",
  "value": 1
}

# Step 4: Accept answer (User A - question owner)
POST {{baseUrl}}/qa/answers/ANSWER_ID_FROM_STEP_2/accept
Authorization: Bearer {{accessToken}}

# Step 5: Check User B's stats (should show increased reputation)
GET {{baseUrl}}/qa/users/USER_B_ID/stats

###############################################
# ERROR TESTING
###############################################

### Test: Create question without auth (should fail)
POST {{baseUrl}}/qa/questions
Content-Type: application/json

{
  "title": "Test question",
  "body": "Test body"
}

### Test: Vote on own content (should fail)
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "targetType": "Question",
  "targetId": "YOUR_OWN_QUESTION_ID",
  "value": 1
}

### Test: Accept answer without being question owner (should fail)
POST {{baseUrl}}/qa/answers/ANSWER_ID/accept
Authorization: Bearer DIFFERENT_USER_TOKEN

### Test: Invalid vote value (should fail)
POST {{baseUrl}}/qa/vote
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "targetType": "Question",
  "targetId": "QUESTION_ID",
  "value": 5
}

### Test: Too short question title (should fail)
POST {{baseUrl}}/qa/questions
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "title": "Short",
  "body": "This title is too short",
  "tags": ["test"]
}
