### Report System API Tests
### Prerequisites: Replace {{accessToken}}, {{adminToken}}, {{courseId}}, {{postId}}, {{userId}}, {{reportId}}

@baseUrl = http://localhost:3000/api/v1
@accessToken = YOUR_USER_ACCESS_TOKEN
@adminToken = YOUR_ADMIN_ACCESS_TOKEN
@courseId = VALID_COURSE_ID
@postId = VALID_POST_ID
@userId = VALID_USER_ID
@reportId = VALID_REPORT_ID

### ============================
### USER ENDPOINTS
### ============================

### 1. Create a Report - Course
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "course",
  "reportedEntity": "{{courseId}}",
  "reportedUser": "{{userId}}",
  "category": "spam",
  "description": "This course contains spam content and misleading information that violates platform guidelines."
}

###

### 2. Create a Report - Post
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "post",
  "reportedEntity": "{{postId}}",
  "reportedUser": "{{userId}}",
  "category": "harassment",
  "description": "This post contains harassing and offensive language directed at other users."
}

###

### 3. Create a Report - User
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "user",
  "reportedEntity": "{{userId}}",
  "reportedUser": "{{userId}}",
  "category": "scam",
  "description": "This user is engaging in fraudulent activities and scamming other platform users."
}

###

### 4. Create a Report - Inappropriate Content
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "course",
  "reportedEntity": "{{courseId}}",
  "category": "inappropriate-content",
  "description": "This course contains inappropriate and offensive content that is not suitable for educational purposes."
}

###

### 5. Get My Reports (User's own reports)
GET {{baseUrl}}/reports/my-reports?page=1&limit=10
Authorization: Bearer {{accessToken}}

###

### 6. Get My Reports - Page 2
GET {{baseUrl}}/reports/my-reports?page=2&limit=5
Authorization: Bearer {{accessToken}}

###

### ============================
### ADMIN ENDPOINTS
### ============================

### 7. Get All Reports (Admin)
GET {{baseUrl}}/reports/admin/all
Authorization: Bearer {{adminToken}}

###

### 8. Get All Reports - Filter by Status (Pending)
GET {{baseUrl}}/reports/admin/all?status=pending&page=1&limit=20
Authorization: Bearer {{adminToken}}

###

### 9. Get All Reports - Filter by Type (Course)
GET {{baseUrl}}/reports/admin/all?reportType=course
Authorization: Bearer {{adminToken}}

###

### 10. Get All Reports - Filter by Category (Spam)
GET {{baseUrl}}/reports/admin/all?category=spam
Authorization: Bearer {{adminToken}}

###

### 11. Get All Reports - Multiple Filters
GET {{baseUrl}}/reports/admin/all?status=pending&reportType=post&category=harassment
Authorization: Bearer {{adminToken}}

###

### 12. Get Report Statistics (Admin)
GET {{baseUrl}}/reports/admin/stats
Authorization: Bearer {{adminToken}}

###

### 13. Get Single Report Details (Admin)
GET {{baseUrl}}/reports/admin/{{reportId}}
Authorization: Bearer {{adminToken}}

###

### 14. Dismiss Report (Admin)
PATCH {{baseUrl}}/reports/admin/{{reportId}}/dismiss
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "adminNotes": "After review, this report does not constitute a violation of our guidelines."
}

###

### 15. Dismiss Report Without Notes
PATCH {{baseUrl}}/reports/admin/{{reportId}}/dismiss
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{}

###

### 16. Take Action - Delete Content Only
PATCH {{baseUrl}}/reports/admin/{{reportId}}/action
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "action": "delete-content",
  "adminNotes": "Content removed due to policy violation."
}

###

### 17. Take Action - Ban User Only
PATCH {{baseUrl}}/reports/admin/{{reportId}}/action
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "action": "ban-user",
  "adminNotes": "User has been permanently banned for repeated violations."
}

###

### 18. Take Action - Delete Content AND Ban User
PATCH {{baseUrl}}/reports/admin/{{reportId}}/action
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "action": "delete-and-ban",
  "adminNotes": "Severe violation - content deleted and user banned permanently."
}

###

### 19. Mark Reporter as Spam (Admin)
PATCH {{baseUrl}}/reports/admin/mark-spam/{{userId}}
Authorization: Bearer {{adminToken}}

###

### ============================
### ERROR CASES
### ============================

### 20. Create Report - Missing Required Fields
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "course"
}

###

### 21. Create Report - Invalid Report Type
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "invalid-type",
  "reportedEntity": "{{courseId}}",
  "category": "spam",
  "description": "This should fail"
}

###

### 22. Create Report - Description Too Short
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "course",
  "reportedEntity": "{{courseId}}",
  "category": "spam",
  "description": "Short"
}

###

### 23. Create Report - Invalid Entity ID
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "course",
  "reportedEntity": "invalid-id",
  "category": "spam",
  "description": "This should fail due to invalid ID"
}

###

### 24. Get Reports Without Authentication
GET {{baseUrl}}/reports/my-reports

###

### 25. Admin Endpoint Without Admin Token
GET {{baseUrl}}/reports/admin/all
Authorization: Bearer {{accessToken}}

###

### 26. Take Action - Invalid Action Type
PATCH {{baseUrl}}/reports/admin/{{reportId}}/action
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "action": "invalid-action",
  "adminNotes": "This should fail"
}

###

### 27. Create Duplicate Report (Should Fail)
# First, create a report, then try to create the same report again
POST {{baseUrl}}/reports
Content-Type: application/json
Authorization: Bearer {{accessToken}}

{
  "reportType": "course",
  "reportedEntity": "{{courseId}}",
  "category": "spam",
  "description": "Duplicate report test - should fail if a pending report already exists"
}

###

### ============================
### TESTING WORKFLOW
### ============================

### Step 1: Create a new report as a user
### Step 2: Get my reports to see the new report
### Step 3: As admin, get all reports to see it in the admin dashboard
### Step 4: As admin, get the specific report details
### Step 5: As admin, either dismiss or take action on the report
### Step 6: Verify the report status changed

###

### Notes:
### - Replace all placeholder values ({{accessToken}}, {{courseId}}, etc.) with actual values
### - Ensure you have valid user and admin accounts
### - Test in order: user creates report → admin reviews → admin takes action
### - Check spam detection by dismissing multiple reports from the same user
