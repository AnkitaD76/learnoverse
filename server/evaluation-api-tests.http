###
### Evaluation System API Tests
### Test the complete flow of creating, submitting, and grading evaluations
###

@baseUrl = http://localhost:3000/api/v1
@instructorToken = YOUR_INSTRUCTOR_TOKEN
@studentToken = YOUR_STUDENT_TOKEN
@courseId = YOUR_COURSE_ID

###
### INSTRUCTOR FLOW
###

### 1. Create a new evaluation (draft)
POST {{baseUrl}}/courses/{{courseId}}/evaluations
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "type": "assignment",
  "title": "Final Assignment - Web Development",
  "description": "Create a comprehensive web application demonstrating all concepts learned",
  "totalMarks": 100,
  "weight": 30,
  "questions": [
    {
      "prompt": "Explain the concept of RESTful APIs and provide three key principles.",
      "maxMarks": 25
    },
    {
      "prompt": "Describe the difference between authentication and authorization with examples.",
      "maxMarks": 25
    },
    {
      "prompt": "What are the benefits of using React hooks? Provide examples of at least two hooks.",
      "maxMarks": 25
    },
    {
      "prompt": "Explain database normalization and why it is important.",
      "maxMarks": 25
    }
  ]
}

### 2. Get instructor's evaluations for a course
GET {{baseUrl}}/courses/{{courseId}}/evaluations/instructor
Authorization: Bearer {{instructorToken}}

### 3. Get evaluation details
GET {{baseUrl}}/evaluations/EVALUATION_ID
Authorization: Bearer {{instructorToken}}

### 4. Update evaluation (draft only)
PUT {{baseUrl}}/evaluations/EVALUATION_ID
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "title": "Final Assignment - Web Development (Updated)",
  "weight": 35
}

### 5. Publish evaluation
POST {{baseUrl}}/evaluations/EVALUATION_ID/publish
Authorization: Bearer {{instructorToken}}

### 6. Get submissions for an evaluation
GET {{baseUrl}}/evaluations/EVALUATION_ID/submissions
Authorization: Bearer {{instructorToken}}

### 7. Grade a submission
POST {{baseUrl}}/submissions/SUBMISSION_ID/grade
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "totalScore": 85,
  "feedback": "Excellent work! Your explanations were clear and comprehensive. Consider providing more real-world examples in future assignments."
}

### 8. Close evaluation
POST {{baseUrl}}/evaluations/EVALUATION_ID/close
Authorization: Bearer {{instructorToken}}

###
### STUDENT FLOW
###

### 9. Get student's evaluations for a course
GET {{baseUrl}}/courses/{{courseId}}/evaluations
Authorization: Bearer {{studentToken}}

### 10. Get evaluation details (student view)
GET {{baseUrl}}/evaluations/EVALUATION_ID
Authorization: Bearer {{studentToken}}

### 11. Submit evaluation answers
POST {{baseUrl}}/evaluations/EVALUATION_ID/submit
Authorization: Bearer {{studentToken}}
Content-Type: application/json

{
  "answers": [
    {
      "questionId": "QUESTION_1_ID",
      "responseText": "RESTful APIs follow the Representational State Transfer architectural style. Three key principles are: 1) Statelessness - each request contains all information needed, 2) Client-Server separation - frontend and backend are independent, 3) Uniform Interface - consistent methods like GET, POST, PUT, DELETE."
    },
    {
      "questionId": "QUESTION_2_ID",
      "responseText": "Authentication verifies WHO you are (login with username/password), while Authorization determines WHAT you can access (user roles and permissions). Example: logging into a system is authentication, accessing admin panel is authorization."
    },
    {
      "questionId": "QUESTION_3_ID",
      "responseText": "React hooks allow functional components to use state and lifecycle features. Benefits include cleaner code and better reusability. Examples: useState for managing component state, useEffect for side effects like API calls."
    },
    {
      "questionId": "QUESTION_4_ID",
      "responseText": "Database normalization organizes data to reduce redundancy and improve integrity. It's important because it prevents data anomalies, saves storage space, and makes queries more efficient by eliminating duplicate data."
    }
  ]
}

### 12. Get student's own submission
GET {{baseUrl}}/evaluations/EVALUATION_ID/my-submission
Authorization: Bearer {{studentToken}}

###
### QUIZ EXAMPLE
###

### 13. Create a quiz
POST {{baseUrl}}/courses/{{courseId}}/evaluations
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "type": "quiz",
  "title": "Mid-term Quiz - Database Concepts",
  "description": "Answer all questions in your own words",
  "totalMarks": 50,
  "weight": 20,
  "questions": [
    {
      "prompt": "Define ACID properties in database systems.",
      "maxMarks": 10
    },
    {
      "prompt": "What is the difference between SQL and NoSQL databases?",
      "maxMarks": 10
    },
    {
      "prompt": "Explain the concept of database indexing.",
      "maxMarks": 10
    },
    {
      "prompt": "What are database transactions and why are they important?",
      "maxMarks": 10
    },
    {
      "prompt": "Describe three types of database relationships.",
      "maxMarks": 10
    }
  ]
}

###
### ERROR CASES
###

### 14. Try to submit twice (should fail)
POST {{baseUrl}}/evaluations/EVALUATION_ID/submit
Authorization: Bearer {{studentToken}}
Content-Type: application/json

{
  "answers": [
    {
      "questionId": "QUESTION_1_ID",
      "responseText": "Second attempt - should fail"
    }
  ]
}

### 15. Try to publish without weight (should fail)
POST {{baseUrl}}/courses/{{courseId}}/evaluations
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "type": "assignment",
  "title": "Test Assignment",
  "totalMarks": 100,
  "weight": 0,
  "questions": [
    {
      "prompt": "Test question",
      "maxMarks": 100
    }
  ]
}

### 16. Try to edit after publishing (should fail)
PUT {{baseUrl}}/evaluations/PUBLISHED_EVALUATION_ID
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "title": "Updated title - should fail"
}

### 17. Try to grade already graded submission (should fail)
POST {{baseUrl}}/submissions/GRADED_SUBMISSION_ID/grade
Authorization: Bearer {{instructorToken}}
Content-Type: application/json

{
  "totalScore": 90,
  "feedback": "Trying to update grade - should fail"
}
