###
# WALLET SYSTEM API TESTS
# 
# This file contains HTTP requests for testing the wallet system endpoints.
# Use with REST Client extension in VS Code or similar tools.
# 
# Setup:
# 1. Start the server: npm run dev
# 2. Login to get auth token
# 3. Replace {{token}} with your actual JWT token
# 4. Replace {{userId}} and {{courseId}} with actual IDs from your database

@baseUrl = http://localhost:3000/api/v1
@token = your-jwt-token-here
@adminToken = your-admin-jwt-token-here
@targetUserId = user-id-to-test-with
@courseId = course-id-to-test-with

###############################################################################
# USER WALLET ENDPOINTS
###############################################################################

### Get Wallet Balance
GET {{baseUrl}}/wallet/balance
Authorization: Bearer {{token}}

### Get Transaction History
GET {{baseUrl}}/wallet/transactions?page=1&limit=10
Authorization: Bearer {{token}}

### Get Transaction History with Filters
GET {{baseUrl}}/wallet/transactions?type=PURCHASE&status=COMPLETED
Authorization: Bearer {{token}}

### Get Exchange Rates
GET {{baseUrl}}/wallet/exchange-rates
Authorization: Bearer {{token}}

### Buy Points - USD with Card
POST {{baseUrl}}/wallet/buy-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "amount": 50,
  "currency": "USD",
  "payment_method": "CARD",
  "payment_details": {
    "card_number": "4111111111111111",
    "cvv": "123",
    "expiry": "12/25"
  }
}

### Buy Points - BDT with bKash
POST {{baseUrl}}/wallet/buy-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "amount": 1000,
  "currency": "BDT",
  "payment_method": "BKASH",
  "payment_details": {
    "phone_number": "01712345678"
  }
}

### Buy Points - EUR with PayPal
POST {{baseUrl}}/wallet/buy-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "amount": 100,
  "currency": "EUR",
  "payment_method": "PAYPAL",
  "payment_details": {
    "email": "user@example.com"
  }
}

### Sell Points - Bank Transfer
POST {{baseUrl}}/wallet/sell-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "points": 500,
  "currency": "USD",
  "payout_method": "BANK_TRANSFER",
  "payout_details": {
    "account_number": "1234567890",
    "account_name": "John Doe",
    "bank_name": "Example Bank",
    "routing_number": "123456789"
  }
}

### Sell Points - bKash
POST {{baseUrl}}/wallet/sell-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "points": 1000,
  "currency": "BDT",
  "payout_method": "BKASH",
  "payout_details": {
    "phone_number": "01712345678",
    "account_name": "John Doe"
  }
}

### Get Payout Requests
GET {{baseUrl}}/wallet/payouts?page=1&limit=10
Authorization: Bearer {{token}}

### Get Pending Payouts Only
GET {{baseUrl}}/wallet/payouts?status=PENDING
Authorization: Bearer {{token}}

###############################################################################
# COURSE ENROLLMENT WITH POINTS
###############################################################################

### Enroll in Course with Points
POST {{baseUrl}}/courses/{{courseId}}/enroll-with-points
Authorization: Bearer {{token}}

###############################################################################
# ADMIN WALLET ENDPOINTS
###############################################################################

### Set Exchange Rate
POST {{baseUrl}}/admin/wallet/exchange-rates
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "currency": "USD",
  "rate": 105,
  "reason": "Market rate adjustment"
}

### Set Exchange Rate - BDT
POST {{baseUrl}}/admin/wallet/exchange-rates
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "currency": "BDT",
  "rate": 1.2,
  "reason": "Currency fluctuation adjustment"
}

### Get Exchange Rate History
GET {{baseUrl}}/admin/wallet/exchange-rates/history?limit=20
Authorization: Bearer {{adminToken}}

### Get Exchange Rate History for Specific Currency
GET {{baseUrl}}/admin/wallet/exchange-rates/history?currency=USD&limit=10
Authorization: Bearer {{adminToken}}

### Admin - Credit Points to User
POST {{baseUrl}}/admin/wallet/adjust-balance
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "targetUserId": "{{targetUserId}}",
  "points": 1000,
  "type": "CREDIT",
  "reason": "Compensation for technical issue during checkout on 2025-12-18"
}

### Admin - Debit Points from User
POST {{baseUrl}}/admin/wallet/adjust-balance
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "targetUserId": "{{targetUserId}}",
  "points": 500,
  "type": "DEBIT",
  "reason": "Correction for duplicate points awarded on 2025-12-17 due to system bug"
}

### Admin - Get Pending Payouts
GET {{baseUrl}}/admin/wallet/pending-payouts?limit=50
Authorization: Bearer {{adminToken}}

### Admin - Approve Payout
POST {{baseUrl}}/admin/wallet/payouts/PAYOUT_ID_HERE/process
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "action": "APPROVE",
  "reason": "Verified bank account details - manual approval"
}

### Admin - Reject Payout
POST {{baseUrl}}/admin/wallet/payouts/PAYOUT_ID_HERE/process
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "action": "REJECT",
  "reason": "Invalid bank account - unable to process payout"
}

### Admin - Get Wallet Statistics
GET {{baseUrl}}/admin/wallet/statistics
Authorization: Bearer {{adminToken}}

### Admin - Get User Wallet Details
GET {{baseUrl}}/admin/wallet/users/{{targetUserId}}/details
Authorization: Bearer {{adminToken}}

###############################################################################
# ERROR TEST CASES
###############################################################################

### Buy Points - Invalid Amount
POST {{baseUrl}}/wallet/buy-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "amount": -50,
  "currency": "USD",
  "payment_method": "CARD"
}

### Buy Points - Invalid Currency
POST {{baseUrl}}/wallet/buy-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "amount": 50,
  "currency": "JPY",
  "payment_method": "CARD"
}

### Buy Points - Invalid Payment Method
POST {{baseUrl}}/wallet/buy-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "amount": 50,
  "currency": "USD",
  "payment_method": "CASH"
}

### Sell Points - Insufficient Balance
POST {{baseUrl}}/wallet/sell-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "points": 1000000,
  "currency": "USD",
  "payout_method": "BANK_TRANSFER",
  "payout_details": {
    "account_number": "1234567890",
    "account_name": "John Doe",
    "bank_name": "Example Bank"
  }
}

### Sell Points - Below Minimum
POST {{baseUrl}}/wallet/sell-points
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "points": 50,
  "currency": "USD",
  "payout_method": "BANK_TRANSFER",
  "payout_details": {
    "account_number": "1234567890"
  }
}

### Enroll in Course - Insufficient Points
POST {{baseUrl}}/courses/{{courseId}}/enroll-with-points
Authorization: Bearer {{token}}

### Admin - Adjust Balance with Short Reason
POST {{baseUrl}}/admin/wallet/adjust-balance
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "targetUserId": "{{targetUserId}}",
  "points": 100,
  "type": "CREDIT",
  "reason": "Short"
}

###############################################################################
# WORKFLOW TEST SCENARIOS
###############################################################################

### Scenario 1: Complete Buy-Enroll-Sell Flow
# Step 1: Buy 5000 points (50 USD)
# Step 2: Check balance
# Step 3: Enroll in course (cost: 2500 points)
# Step 4: Check balance again (should be 2500)
# Step 5: Sell remaining points (250 points = 2.50 USD)

### Scenario 2: Admin Compensation Flow
# Step 1: Admin credits 1000 bonus points
# Step 2: User checks transaction history
# Step 3: User sees ADMIN_CREDIT transaction

### Scenario 3: Failed Payout Refund Flow
# Step 1: User requests payout (points debited immediately)
# Step 2: Mock payout fails (5% chance)
# Step 3: System auto-creates REFUND transaction
# Step 4: User balance restored
# Step 5: User sees REFUND in transaction history

###############################################################################
# SEED DATA (Run once on fresh database)
###############################################################################

### Note: These would need to be run programmatically or via a seed script
### See: server/src/utils/seedWallet.js

# Default exchange rates will be seeded automatically on first run:
# - USD: 1 = 100 points
# - BDT: 1 = 1 point
# - EUR: 1 = 110 points
# - GBP: 1 = 125 points
